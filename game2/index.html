import turtle

# Set up the screen
screen = turtle.Screen()
screen.title("Happy Dog Adventure - Turtle Edition")
screen.bgcolor("skyblue")
screen.setup(width=800, height=600)
screen.tracer(0)  # Manual updates for smoothness
screen.listen()

# Ground
ground = turtle.Turtle()
ground.speed(0)
ground.penup()
ground.goto(-400, -250)
ground.pendown()
ground.color("brown")
ground.forward(800)
ground.hideturtle()

# Score display
score_turtle = turtle.Turtle()
score_turtle.speed(0)
score_turtle.penup()
score_turtle.goto(-350, 200)
score_turtle.hideturtle()
score_turtle.color("black")
score_turtle.write("Score: 0", align="left", font=("Arial", 16, "normal"))

# Blocks (simple rectangles)
def draw_block(x, y, color="gray"):
    block = turtle.Turtle()
    block.speed(0)
    block.penup()
    block.goto(x, y)
    block.pendown()
    block.color(color)
    block.begin_fill()
    for _ in range(2):
        block.forward(40)
        block.right(90)
        block.forward(40)
        block.right(90)
    block.end_fill()
    block.hideturtle()
    return block

block1 = draw_block(-100, -200)
block2 = draw_block(50, -150)

# Pipe (simple green rectangle with top)
pipe_base = draw_block(250, -250, "green")
pipe_top = turtle.Turtle()
pipe_top.speed(0)
pipe_top.penup()
pipe_top.goto(250, -210)
pipe_top.pendown()
pipe_top.color("darkgreen")
pipe_top.begin_fill()
pipe_top.forward(60)
pipe_top.right(90)
pipe_top.forward(40)
pipe_top.right(90)
pipe_top.forward(60)
pipe_top.right(90)
pipe_top.forward(40)
pipe_top.end_fill()
pipe_top.hideturtle()

# Player: Happy Dog
dog = turtle.Turtle()
dog.shape("circle")
dog.color("yellow")
dog.shapesize(1.5)
dog.penup()
dog.goto(-350, -240)
dog.dy = 0
dog.on_ground = True
dog.lives = 3  # Simple reset counter

# Dog face overlay
face = turtle.Turtle()
face.speed(0)
face.penup()
face.hideturtle()

def draw_dog_face():
    face.clear()
    fx, fy = dog.xcor(), dog.ycor()
    face.goto(fx, fy)
    face.dot(30, "yellow")  # Body circle
    face.goto(fx - 8, fy + 4)
    face.dot(3, "black")  # Left eye
    face.goto(fx + 8, fy + 4)
    face.dot(3, "black")  # Right eye
    face.goto(fx, fy - 4)
    face.pendown()
    face.color("black")
    face.circle(6, 180)  # Smile arc
    face.penup()

# Bats (enemies)
class Bat:
    def __init__(self, x, y):
        self.t = turtle.Turtle()
        self.t.shape("triangle")
        self.t.color("red")
        self.t.shapesize(1, 1.5)
        self.t.penup()
        self.t.goto(x, y)
        self.t.dx = -2  # Speed

bat1 = Bat(0, -200)
bat2 = Bat(200, -200)
bats = [bat1, bat2]

# Controls
def go_left():
    x = dog.xcor() - 10
    dog.goto(max(-400, x), dog.ycor())  # Screen bounds

def go_right():
    x = dog.xcor() + 10
    dog.goto(min(400, x), dog.ycor())

def jump():
    if dog.on_ground:
        dog.dy = 12
        dog.on_ground = False

screen.onkey(go_left, "Left")
screen.onkey(go_right, "Right")
screen.onkey(jump, "space")

# Game vars
score = 0
game_over = False

# Game loop
def update():
    global score, game_over
    if game_over:
        return

    # Player physics
    dog.dy -= 0.8  # Gravity
    y = dog.ycor() + dog.dy
    dog.sety(y)

    # Ground collision
    if dog.ycor() <= -240:
        dog.sety(-240)
        dog.dy = 0
        dog.on_ground = True

    # Block collisions (landing or head bump)
    blocks = [(block1, -200, -160), (block2, -150, -110)]  # (turtle, bottom_y, top_y)
    for _, bottom, top in blocks:
        if bottom < dog.ycor() < top + 20:  # Near block height
            if dog.dy < 0:  # Falling: land on top
                dog.sety(top)
                dog.dy = 0
                dog.on_ground = True
            elif dog.dy > 0:  # Rising: bump head
                dog.sety(bottom - 20)
                dog.dy = 0

    # Pipe collision (treat as wide platform)
    if 250 < dog.xcor() < 310 and dog.ycor() < -240:
        if dog.dy < 0:
            dog.sety(-240)
            dog.dy = 0
            dog.on_ground = True

    # Bat updates
    for bat in bats[:]:
        bat.t.goto(bat.t.xcor() + bat.t.dx, bat.t.ycor())
        if bat.t.xcor() < -400 or bat.t.xcor() > 400:
            bat.t.dx *= -1

        # Dog-bat collision
        if abs(dog.xcor() - bat.t.xcor()) < 25 and abs(dog.ycor() - bat.t.ycor()) < 25:
            if dog.dy < 0 and dog.ycor() > bat.t.ycor():  # Stomp from above
                bats.remove(bat)
                bat.t.hideturtle()
                dog.dy = 8  # Bounce
                score += 10
            else:  # Hit from side/bottom
                dog.lives -= 1
                dog.goto(-350, -240)
                dog.dy = 0
                dog.on_ground = True
                if dog.lives <= 0:
                    game_over = True
                    msg = turtle.Turtle()
                    msg.speed(0)
                    msg.penup()
                    msg.goto(0, 0)
                    msg.color("red")
                    msg.write("Game Over! Final Score: {}".format(score), align="center", font=("Arial", 24, "bold"))
                    msg.hideturtle()

    # Draw face and update score
    draw_dog_face()
    score_turtle.clear()
    score_turtle.write("Score: {} | Lives: {}".format(score, dog.lives), align="left", font=("Arial", 16, "normal"))

    # Win condition
    if len(bats) == 0:
        win_msg = turtle.Turtle()
        win_msg.speed(0)
        win_msg.penup()
        win_msg.goto(0, 0)
        win_msg.color("green")
        win_msg.write("You Win! All bats defeated. Score: {}".format(score), align="center", font=("Arial", 24, "bold"))
        win_msg.hideturtle()
        game_over = True

    screen.update()
    if not game_over:
        screen.ontimer(update, 50)  # ~20 FPS

# Start the game
draw_dog_face()  # Initial draw
update()
screen.mainloop()
