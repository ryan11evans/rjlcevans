import turtle
import time

# Set up the screen
screen = turtle.Screen()
screen.title("Happy Dog Adventure - Turtle Edition")
screen.bgcolor("skyblue")
screen.setup(width=800, height=600)
screen.tracer(0)  # Turn off animation for smoother updates
screen.listen()

# Ground
ground = turtle.Turtle()
ground.speed(0)
ground.penup()
ground.goto(-400, -250)
ground.pendown()
ground.color("brown")
ground.forward(800)
ground.hideturtle()

# Blocks (simple rectangles)
def draw_block(x, y):
    block = turtle.Turtle()
    block.speed(0)
    block.penup()
    block.goto(x, y)
    block.pendown()
    block.color("gray")
    block.begin_fill()
    for _ in range(2):
        block.forward(40)
        block.right(90)
        block.forward(40)
        block.right(90)
    block.end_fill()
    block.hideturtle()
    return block

block1 = draw_block(-200, -200)
block2 = draw_block(0, -150)
pipe = turtle.Turtle()  # Simple pipe
pipe.speed(0)
pipe.penup()
pipe.goto(200, -250)
pipe.pendown()
pipe.color("green")
pipe.begin_fill()
for _ in range(2):
    pipe.left(90)
    pipe.forward(50)
    pipe.circle(25, 180)  # Top curve
    pipe.forward(50)
pipe.end_fill()
pipe.hideturtle()

# Player: Happy Dog
dog = turtle.Turtle()
dog.shape("circle")
dog.color("yellow")
dog.shapesize(2)
dog.penup()
dog.goto(-350, -250)
dog.dy = 0
dog.on_ground = True

# Simple dog face on dog (separate turtle for overlay)
face = turtle.Turtle()
face.speed(0)
face.penup()
face.hideturtle()

def draw_dog_face():
    face.clear()
    face.goto(dog.xcor(), dog.ycor())
    face.dot(40, "yellow")  # Body
    face.goto(dog.xcor() - 10, dog.ycor() + 5)
    face.dot(5, "black")  # Left eye
    face.goto(dog.xcor() + 10, dog.ycor() + 5)
    face.dot(5, "black")  # Right eye
    face.goto(dog.xcor(), dog.ycor() - 5)
    face.right(90)
    face.circle(8, 180)  # Smile

# Bats (enemies)
bats = []
class Bat:
    def __init__(self, x, y):
        self.t = turtle.Turtle()
        self.t.shape("circle")
        self.t.color("red")
        self.t.shapesize(1.5, 0.5)
        self.t.penup()
        self.t.goto(x, y)
        self.t.dx = -2
        self.hideturtle()  # Wait, no

bat1 = Bat(100, -200)
bat2 = Bat(300, -250)
bats = [bat1, bat2]

# Controls
def left():
    dog.goto(dog.xcor() - 20, dog.ycor())

def right():
    dog.goto(dog.xcor() + 20, dog.ycor())

def jump():
    if dog.on_ground:
        dog.dy = 15
        dog.on_ground = False

screen.onkey(left, "Left")
screen.onkey(right, "Right")
screen.onkey(jump, "space")

# Game loop
def update():
    global score
    score = 0
    
    # Gravity and jump
    dog.dy -= 1
    y = dog.ycor() + dog.dy
    dog.sety(y)
    
    # Ground collision
    if dog.ycor() < -240:
        dog.sety(-240)
        dog.dy = 0
        dog.on_ground = True
    
    # Block collisions (simple)
    if -210 < dog.xcor() < -170 and -200 < dog.ycor() < -160:
        if dog.dy > 0:
            dog.sety(-160)
            dog.dy = 0
            dog.on_ground = True
    if -10 < dog.xcor() < 30 and -150 < dog.ycor() < -110:
        if dog.dy > 0:
            dog.sety(-110)
            dog.dy = 0
            dog.on_ground = True
    
    # Pipe collision
    if dog.xcor() > 170 and dog.ycor() < -240:
        if dog.dy > 0:
            dog.sety(-240)
            dog.dy = 0
            dog.on_ground = True
    
    # Bat updates and collisions
    for bat in bats[:]:
        bat.t.goto(bat.t.xcor() + bat.dx, bat.t.ycor())
        if bat.t.xcor() < -400 or bat.t.xcor() > 400:
            bat.dx *= -1
        
        # Collision with dog
        if abs(dog.xcor() - bat.t.xcor()) < 30 and abs(dog.ycor() - bat.t.ycor()) < 30:
            if dog.dy > 0 and dog.ycor() < bat.t.ycor():  # Stomp
                bats.remove(bat)
                bat.t.hideturtle()
                dog.dy = 10
                score += 10
            else:
                # Reset
                dog.goto(-350, -240)
                dog.dy = 0
                dog.on_ground = True
    
    # Draw dog face
    draw_dog_face()
    
    # Check win/lose
    if len(bats) == 0:
        turtle.write("You win! All bats gone!", align="center", font=("Arial", 16, "bold"))
    
    screen.update()
    if len(bats) > 0:  # Continue if bats left
        screen.ontimer(update, 50)

# Start
update()

# Keep window open
screen.mainloop()
